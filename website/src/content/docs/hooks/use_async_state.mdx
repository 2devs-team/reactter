---
title: UseAsyncState
description: Learn how to use the `useAsyncState` hook in Reactter.
sidebar:
  order: 2
---
import { HE, HK, HM, HT } from '@/components/Highlight';
import MDXRedry from '@/components/MDXRedry.astro';
import StateMethodsLite from '@/content/docs/shareds/state_methods_lite.mdx';
import * as NoteStateValueNotifies from '@/content/docs/shareds/note_state_value_notifies.mdx';
import * as ListeningChangesHook from '@/content/docs/shareds/listening_changes_hook.mdx';

<HT><a href="https://pub.dev/documentation/reactter/latest/reactter/UseAsyncState-class.html">`UseAsyncState`</a></HT> is a [hook](/reactter/core_concepts/hooks) that allows to declare state variables and manipulate its `value` asynchronously, which in turn notifies about its changes to listeners.

## Syntax

```dart
UseAsyncState<T>(
  T initialValue,
  Future<T> asyncFunction(),
);

// UseAsyncState with arguments
UseAsyncState<T, A>.withArg(
  T initialValue,
  Future<T> asyncFunction(A arg),
);
```

<HT>`UseAsyncState`</HT> accepts these properties:

- `initialValue`: Initial value of <HT>`T`</HT> type that it will hold.
- <HM>`asyncFunction`</HM>: A function that returns a <HT>`Future<T>`</HT> to update the state asynchronously.
  This function is called by the <HM>`resolve`</HM> method and sets the `value` property.

## Properties & Methods

<HT>`UseAsyncState`</HT> provides the following properties and methods:

- `value`: A getter that allows to read its state.
- `status`: A getter that allows to read its status. It can be:
  - <HE>`UseAsyncStateStatus.standby`</HE>: Represents the standby status, indicating that the state is idle.
  - <HE>`UseAsyncStateStatus.loading`</HE>: Denotes the loading status, indicating that an asynchronous operation is in progress.
  - <HE>`UseAsyncStateStatus.done`</HE>: Indicates that the asynchronous operation has been successfully completed.
  - <HE>`UseAsyncStateStatus.error`</HE>: Signifies that an error has occurred during the asynchronous operation.
- `error`: A getter that allows to get the error object when the <HM>`asyncFunction`</HM> fails.
- <HM>`resolve`</HM>: A method that updates the state asynchronously by calling the <HM>`asyncFunction`</HM> function.
  - Syntax:
    ```dart
    FutureOr<T?> resolve();
    // for UseAsyncState.withArg
    FutureOr<T?> resolve(A arg);
    ```
- <HM>`when`</HM>: A method that allows to computed a value depending on its status.
  - Syntax:
    ```dart
    R? when<R>({
      WhenValueReturn<T, R>? standby,
      WhenValueReturn<T, R>? loading,
      WhenValueReturn<T, R>? done,
      WhenErrorReturn<R>? error,
    });
    ```
  - Arguments:
    - <HM>`standby`</HM>: A function that returns a value when the state is <HE>`UseAsyncStateStatus.standby`</HE>.
    - <HM>`loading`</HM>: A function that returns a value when the state is <HE>`UseAsyncStateStatus.loading`</HE>.
    - <HM>`done`</HM>: A function that returns a value when the state is <HE>`UseAsyncStateStatus.done`</HE>.
    - <HM>`error`</HM>: A function that returns a value when the state is <HE>`UseAsyncStateStatus.error`</HE>.

<StateMethodsLite />

## Usage

### Declaration

<HT>`UseAsyncState`</HT> can be initialized using the constructor class:

```dart "UseAsyncState"
final uAsyncState = UseAsyncState<String>('Initial value', asyncFunction);

Future<String> asyncFunction() async {
  await Future.delayed(Duration(seconds: 2));
  return "Resolved value";
}
```

### Resolving & reading the value

<HT>`UseAsyncState`</HT> has a <HM>`resolve`</HM> method that updates the state asynchronously by calling the <HM>`asyncFunction`</HM> function.
After resolving the state, you can read the `value`, like this:

```dart
print("Current state: ${uAsyncState.value}"); // Initial value
await uAsyncState.resolve();
print("Current state: ${uAsyncState.value}"); // Resolved value
```

<MDXRedry mdx={NoteStateValueNotifies} vars={{
  hookName: 'UseAsyncState',
}}/>

### Usage with argument

<HT>`UseAsyncState`</HT> can be used with arguments by using the <HM>`withArg`</HM> constructor:

```dart
final uAsyncStateWithArg = UseAsyncState.withArg<String, int>(
  'Initial value',
  asyncFunctionWithArg
);

Future<String> asyncFunctionWithArg(int arg) async {
  await Future.delayed(Duration(seconds: 2));
  return "Resolved value with arg: $arg";
}
```

### Resolving with argument & reading the value

<HT>`UseAsyncState`</HT> has a <HM>`resolve`</HM> method that updates the state asynchronously by calling the <HM>`asyncFunctionWithArg`</HM> function.
After resolving the state, you can read the `value`, like this:

```dart
print("Current state: ${uAsyncStateWithArg.value}"); // Initial value
await uAsyncStateWithArg.resolve(10);
print("Current state: ${uAsyncStateWithArg.value}"); // Resolved value with arg: 10
```

<MDXRedry mdx={NoteStateValueNotifies} vars={{
  hookName: 'UseAsyncState',
}}/>

### Updating the value

Use <HM>`update`</HM> method to notify changes after run a set of instructions:

```dart
uAsyncState.update((value) {
  uAsyncState.value = "New value";
});
```

Use <HM>`refresh`</HM> method to force to notify changes.

```dart
uAsyncState.refresh();
```

### Using `when` method

<HT>`UseAsyncState`</HT> provides a <HM>`when`</HM> method that allows to computed a value depending on its status:

```dart
final result = uAsyncState.when(
  standby: (value) => "Standby",
  loading: (value) => "Loading",
  done: (value) => "Done",
  error: (error) => "Error: $error",
);

print("Result: $result");
```
:::tip[For Flutter]
In flutter, you can use the <HM>`when`</HM> method to update the UI according to the state of the <HT>`UseAsyncState`</HT>, e.g.:

```dart "uAsyncState" "when"
Builder(
  builder: (context) {
    final myController = context.watch<MyController>(
      (inst) => [inst.uAsyncState],
    );

    return myController.uAsyncState.when(
      standby: (value) => Text("Standby: $value"),
      loading: (value) => CircularProgressIndicator(),
      done: (value) => Text("Done: $value"),
      error: (error) => Text("Error: $error"),
    );
  },
);
```

Learn more about [Rendering Control](/reactter/core_concepts/rendering_control) in Reactter.
:::

### Listening to changes

<MDXRedry mdx={ListeningChangesHook} vars={{
  hookName: 'UseAsyncState',
  hookVariable: 'myAsyncState',
}}/>
